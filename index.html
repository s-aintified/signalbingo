<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LOW SIGNAL — Thread Bingo</title>

<style>
  :root{
    --bg:#0f1115; --card:#161a20; --ink:#cfd6e1; --muted:#9aa3b2;
    --accent1:#5078D2; --accent2:#F58264; --accent3:#FFD787; /* fallback if no theme match */
    --success:#6dd5a1; --danger:#d85a5a; --line:rgba(255,255,255,.06);
    --win:#71e4c0;
  }

  /* page wrapper */
  body{margin:0; background:#0b0d11}
  .ls-wrap{
    font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    color:var(--ink);
    background:var(--bg);
    padding:24px;
    border-radius:16px;
    max-width:1100px;
    margin:24px auto;
    box-shadow:0 10px 30px rgba(0,0,0,.4);
    overflow:visible !important;
    min-width:min(1100px,100%);
  }

  /* ===== Title / Brand ===== */
  .ls-head{display:flex; flex-wrap:wrap; gap:16px; align-items:flex-end; justify-content:space-between; margin-bottom:18px}
  .ls-brand{position:relative; padding-right:8px}
  .ls-logo{
    margin:0; line-height:1; font-weight:900; letter-spacing:.8px;
    font-size:30px; text-transform:uppercase;
    background:linear-gradient(90deg,var(--accent1),var(--accent2),var(--accent3));
    -webkit-background-clip:text; background-clip:text; color:transparent;
    filter: drop-shadow(0 2px 12px rgba(0,0,0,.35));
  }
  /* use ls-low (not .thin) so site CSS won’t hide it */
  .ls-logo .ls-low{font-weight:900; opacity:1}
  .ls-spark{
    position:absolute; left:2px; right:120px; height:3px; bottom:-6px; border-radius:999px;
    background:linear-gradient(90deg,transparent,var(--accent1),var(--accent2),var(--accent3),transparent);
    opacity:.85; overflow:hidden;
  }
  .ls-spark::after{
    content:""; position:absolute; inset:0;
    background:linear-gradient(90deg,transparent 0%, #fff 50%, transparent 100%);
    mix-blend-mode:overlay; opacity:.25; transform:translateX(-100%);
    animation:ls-scan 3.6s linear infinite;
  }
  @keyframes ls-scan{to{transform:translateX(100%)}}

  .ls-sub{font-size:12px; color:var(--muted); margin-top:10px}

  /* controls */
  .ls-controls{display:flex; flex-wrap:wrap; gap:10px; align-items:flex-end}
  .ls-field{display:flex; flex-direction:column; gap:6px}
  .ls-label{font-size:11px; color:var(--muted)}
  .ls-input, .ls-select{
    background:#10151c; border:1px solid var(--line); color:var(--ink);
    padding:8px 10px; border-radius:10px; font-size:13px; min-width:180px
  }
  .ls-btn{
    border:1px solid var(--line);
    padding:9px 12px; border-radius:10px;
    background:#1e232b; color:var(--ink); font-size:12px; cursor:pointer;
    box-shadow: 0 6px 18px rgba(0,0,0,.25);
  }
  .ls-btn:hover{filter:brightness(1.12)}
  /* save button: solid, not gradient */
  #saveProfile{
    border:1px solid rgba(255,255,255,.08);
    background:#222834;
    font-weight:700;
  }

  .ls-legend{
    margin:14px 0 16px; padding:12px; border:1px solid var(--line); border-radius:12px;
    background:#121720; font-size:12px; color:var(--muted);
    box-shadow: 0 0 0 1px rgba(255,255,255,.03) inset, 0 0 16px rgba(0,0,0,.25)
  }

  /* ===== Grid (bigger neon borders + no inner scroll) ===== */
  .ls-grid{
    position:relative; display:grid; grid-template-columns:repeat(5,1fr);
    gap:10px; padding:10px; border-radius:14px;
    background:linear-gradient(180deg,#0c0f14,#0a0d12);
    box-shadow: 0 0 0 1px rgba(255,255,255,.04) inset, 0 0 22px rgba(0,0,0,.35);
    overflow:visible !important;
  }
  /* gradient frame around the grid */
  .ls-grid::before{
    content:""; position:absolute; inset:-3px; border-radius:16px; pointer-events:none; opacity:.55;
    background:linear-gradient(90deg,var(--accent1),var(--accent2),var(--accent3));
    -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
    -webkit-mask-composite: xor; mask-composite: exclude;
    padding:3px; filter:blur(.6px);
  }

  .ls-cell{
    position:relative; aspect-ratio:1/1; background:linear-gradient(135deg,#1a1f27,#0f1318);
    border-radius:12px; overflow:hidden; border:1px solid var(--line); cursor:pointer
  }
  /* per-cell gradient border + glow (thicker) */
  .ls-cell::before{
    content:""; position:absolute; inset:-2.5px; border-radius:12px; pointer-events:none;
    background:linear-gradient(90deg,var(--accent1),var(--accent2),var(--accent3));
    -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
    -webkit-mask-composite: xor; mask-composite: exclude;
    padding:2.5px; opacity:.5; filter:blur(.4px);
    box-shadow: 0 0 18px rgba(0,0,0,.35);
  }
  .ls-cell:hover::before{opacity:.65}
  .ls-cell.is-done::before{opacity:.8; filter:blur(.6px)}

  .ls-img{position:absolute; inset:0; background-size:cover; background-position:center; filter:saturate(1.05); opacity:.95}
  .ls-shade{position:absolute; inset:0; background:linear-gradient(180deg,rgba(0,0,0,.15),rgba(0,0,0,.45))}
  .ls-text{position:absolute; left:10px; right:10px; bottom:36px; font-size:12px; line-height:1.25; color:#eaeef7; text-shadow:0 1px 2px rgba(0,0,0,.6)}
  .ls-link{position:absolute; left:10px; bottom:8px; font-size:11px; color:#b8c8ff; text-decoration:underline; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; right:10px}
  .ls-badge{position:absolute; top:8px; left:8px; padding:5px 8px; font-size:10px; border-radius:8px; background:rgba(0,0,0,.55); color:#fff; border:1px solid var(--line)}
  .ls-done{position:absolute; inset:0; display:grid; place-items:center; background:rgba(10,17,12,.55); backdrop-filter: blur(2px); opacity:0; transition:.18s}
  .ls-cell.is-done .ls-done{opacity:1}
  .ls-check{font-size:28px; color:var(--success); text-shadow:0 0 12px rgba(109,213,161,.35)}
  .ls-free{font-weight:700; letter-spacing:.3px}

  /* Win highlight (brighter) */
  .ls-winline{
    position:absolute; pointer-events:none; border-radius:8px;
    box-shadow:
      0 0 0 3px var(--win) inset,
      0 0 26px rgba(113,228,192,.45),
      0 0 50px rgba(113,228,192,.25);
  }
  .ls-banner{position:absolute; top:-10px; right:0; left:0; display:none; justify-content:center}
  .ls-banner span{
    background:linear-gradient(90deg,var(--accent1),var(--accent2),var(--accent3));
    color:#0b1116; font-weight:800; letter-spacing:.18em; padding:8px 14px;
    border-radius:10px; box-shadow:0 14px 28px rgba(0,0,0,.45)
  }
  .ls-banner.show{display:flex}

  /* Modal */
  .ls-modal{position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.5); z-index:9999}
  .ls-modal.show{display:grid}
  .ls-card{width:min(520px,90vw); background:var(--card); border:1px solid var(--line); border-radius:14px; padding:16px; box-shadow:0 20px 50px rgba(0,0,0,.6)}
  .ls-card h3{margin:0 0 8px 0; font-size:16px}
  .ls-row{display:flex; gap:10px; margin-top:10px}
  .ls-row > *{flex:1}
  .ls-note{font-size:11px; color:var(--muted); margin-top:6px}
  .ls-actions{display:flex; gap:8px; justify-content:flex-end; margin-top:12px}
  .ls-mini{font-size:11px; padding:7px 9px; border-radius:8px}
  .ls-danger{background:linear-gradient(90deg,#6b2a2a,#d85a5a); color:#fff}
  .ls-success{background:linear-gradient(90deg,#2b694a,#6dd5a1); color:#0b1116}
  .ls-ghost{background:#1e232b; color:var(--ink)}
  .ls-chk{display:flex; gap:8px; align-items:center; font-size:12px; margin-top:10px}
</style>
</head>

<body>
<div class="ls-wrap" id="bingoApp">
  <div class="ls-head">
    <div class="ls-brand">
      <h1 class="ls-logo"><span class="ls-low">LOW</span> SIGNAL</h1>
      <div class="ls-spark"></div>
      <div class="ls-sub">Single-click = edit • Double-click = toggle complete • Center is FREE • Theme matches your membergroup.</div>
    </div>

    <div class="ls-controls">
      <div class="ls-field">
        <label class="ls-label">profile id</label>
        <input class="ls-input" id="profileId" placeholder="e.g. yana-main or character-name">
      </div>

      <div class="ls-field">
        <label class="ls-label">load saved profile</label>
        <div style="display:flex; gap:8px;">
          <select class="ls-select" id="profilesList"></select>
          <button class="ls-btn" id="loadProfile">load</button>
          <button class="ls-btn" id="deleteProfile">delete</button>
        </div>
      </div>

      <button class="ls-btn" id="saveProfile">save</button>
      <button class="ls-btn" id="resetBoard">reset board</button>
    </div>
  </div>

  <div class="ls-legend">
    <b>Legend:</b> add a thread link + image per square • 5×5 board • win lines highlight and show a BINGO banner.
  </div>

  <div class="ls-grid" id="grid">
    <div class="ls-banner" id="banner"><span>✦ B I N G O ✦</span></div>
    <!-- cells + winline injected by JS -->
  </div>
</div>

<!-- Modal -->
<div class="ls-modal" id="modal">
  <div class="ls-card">
    <h3>Edit Square</h3>
    <div class="ls-row">
      <div>
        <div class="ls-label">prompt</div>
        <input type="text" class="ls-input" id="promptInput" disabled>
      </div>
    </div>
    <div class="ls-row">
      <div>
        <div class="ls-label">thread link (URL)</div>
        <input type="url" class="ls-input" id="urlThread" placeholder="https://yourthreadlink">
      </div>
    </div>
    <div class="ls-row">
      <input type="url" class="ls-input" id="urlImage" placeholder="image URL (optional)">
      <input type="file" class="ls-input" id="fileImage" accept="image/*">
    </div>
    <label class="ls-chk">
      <input type="checkbox" id="doneChk"> mark this square complete
    </label>
    <div class="ls-note">Tip: image URL (imgur/imgbb) saves tiny. File uploads store locally as data URLs.</div>
    <div class="ls-actions">
      <button class="ls-btn ls-mini ls-danger" id="clearImage">remove image</button>
      <button class="ls-btn ls-mini ls-ghost" id="closeModal">close</button>
      <button class="ls-btn ls-mini ls-success" id="saveSquare">save</button>
    </div>
  </div>
</div>

<script>
(() => {
  const SIZE = 5;
  const STORAGE_PREFIX = 'lowSignalBingo_v2_';

  /* === Membergroup palettes (JCink numbers) === */
  window.THEMES = {
    'g-2':  ['#5078D2','#F58264','#FFD787'], // Guest
    'g-4':  ['#8A5A16','#DFA546','#F8CC76'], // Staff
    'g-6':  ['#A13D5B','#E8718A','#FFA0B2'], // Romance
    'g-7':  ['#161B2E','#353E58','#616B89'], // Mystery
    'g-8':  ['#3D338D','#7362E8','#9D8CFF'], // Fantasy
    'g-9':  ['#823424','#BF5C40','#E89A65'], // Drama
    'g-10': ['#00666D','#289DA5','#5AD2DC'], // Sci-Fi
    'g-11': ['#360000','#760A0A','#AA2727'], // Horror
    'g-12': ['#BEAF96','#E6DCC8','#FFFBEF'], // Comedy
    'g-13': ['#856CB6','#C1AAE8','#DFD0FC'], // Tragedy
    'g-14': ['#78645A','#AA917D','#E1CDB9'], // Slice of Life
    'g-16': ['#683616','#B55F2B','#E89952'], // Thriller
  };

  function setThemeFrom(anyKey){
    const classes = (document.body.className || '').split(/\s+/);
    const byBody = classes.find(c => THEMES[c]);
    const byQuery = new URLSearchParams(location.search).get('theme');
    const byAttr  = document.getElementById('bingoApp')?.dataset?.theme;
    const key = (anyKey && THEMES[anyKey]) ? anyKey
              : (byQuery && THEMES[byQuery]) ? byQuery
              : (byAttr && THEMES[byAttr]) ? byAttr
              : byBody || 'g-2';
    const [a,b,c] = THEMES[key];
    document.documentElement.style.setProperty('--accent1', a);
    document.documentElement.style.setProperty('--accent2', b);
    document.documentElement.style.setProperty('--accent3', c);
  }
  window.setTheme = setThemeFrom;
  setThemeFrom();

  // DOM
  const gridEl = document.getElementById('grid');
  const banner = document.getElementById('banner');
  const modal = document.getElementById('modal');
  const promptInput = document.getElementById('promptInput');
  const urlThread = document.getElementById('urlThread');
  const urlImage = document.getElementById('urlImage');
  const fileImage = document.getElementBy
