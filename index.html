<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>LOW SIGNAL — Thread Bingo</title>
<style>
  :root{
    --bg:#0f1115; 
    --card:#161a20; 
    --ink:#cfd6e1; 
    --muted:#9aa3b2;
    --accent1:#5078D2;
    --accent2:#F58264;
    --accent3:#FFD787;
    --success:#6dd5a1;
    --danger:#d85a5a;
    --line:rgba(255,255,255,.06);

    /* WIN highlight color */
    --win:#7fffd4; /* aquamarine neon */
  }

  body{margin:0;background:#0b0d11;color:var(--ink);font:14px/1.5 system-ui}

  .ls-wrap{
    max-width:1100px;margin:24px auto;padding:24px;
    background:var(--bg);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.4)
  }

  .ls-logo{
    font-size:32px;font-weight:900;text-transform:uppercase;
    background:linear-gradient(90deg,var(--accent1),var(--accent2),var(--accent3));
    -webkit-background-clip:text;color:transparent;margin:0 0 8px
  }

  .ls-sub{font-size:12px;color:var(--muted)}

  /* Inputs / Buttons */
  .ls-input,.ls-select{
    background:#10151c;border:1px solid var(--line);border-radius:10px;
    padding:8px 10px;color:var(--ink);min-width:170px
  }
  .ls-btn{background:#1e232b;border:0;color:var(--ink);
    padding:8px 12px;border-radius:10px;cursor:pointer;font-size:12px}
  .ls-btn.save{background:#212733;font-weight:700}

  .ls-legend{font-size:12px;color:var(--muted);padding:10px 12px;
    border:1px solid var(--line);border-radius:10px;margin:12px 0}

  /* Bingo grid */
  .ls-grid{
    position:relative;
    display:grid;grid-template-columns:repeat(5,1fr);
    gap:12px;padding:14px;border-radius:16px;
    background:#0c0f14;box-shadow:0 0 0 1px rgba(255,255,255,.03)
  }
  .ls-grid::before{
    content:"";position:absolute;inset:-4px;border-radius:18px;
    background:linear-gradient(90deg,var(--accent1),var(--accent2),var(--accent3));
    padding:4px;
    -webkit-mask:linear-gradient(#000 0 0) content-box,
                 linear-gradient(#000 0 0);
    -webkit-mask-composite:xor;mask-composite:exclude;
    opacity:.6;filter:blur(.7px)
  }

  /* individual cell */
  .ls-cell{
    position:relative;aspect-ratio:1/1;
    border-radius:12px;
    background:#151a21;cursor:pointer;
    border:2px solid var(--line); /* thicker */
    overflow:hidden;
  }

  .ls-cell::before{
    content:"";position:absolute;inset:-3px;border-radius:12px;
    background:linear-gradient(90deg,var(--accent1),var(--accent2),var(--accent3));
    padding:3px;
    -webkit-mask:linear-gradient(#000 0 0) content-box,
                 linear-gradient(#000 0 0);
    -webkit-mask-composite:xor;mask-composite:exclude;
    opacity:.5;filter:blur(.4px)
  }

  /* WIN CELLS special glow — new */
  .ls-cell.win{
    box-shadow:0 0 18px var(--win), inset 0 0 14px var(--win);
    border-color:var(--win) !important;
  }
  .ls-cell.win::before{opacity:.9 !important;filter:blur(.7px);background:var(--win)}

  .ls-img{position:absolute;inset:0;background-size:cover;background-position:center;opacity:.95}
  .ls-shade{position:absolute;inset:0;background:rgba(0,0,0,.35)}
  .ls-text{position:absolute;left:10px;right:10px;bottom:36px;font-size:12px;color:#fff}
  .ls-link{position:absolute;left:10px;right:10px;bottom:10px;font-size:11px;color:#b8c8ff;text-decoration:underline}
  .ls-badge{position:absolute;top:8px;left:8px;background:rgba(0,0,0,.6);padding:4px 8px;border-radius:8px;font-size:11px;color:#fff}
  .ls-done{position:absolute;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.3);opacity:0;transition:.2s}
  .ls-cell.is-done .ls-done{opacity:1}
  .ls-check{font-size:28px;color:var(--success)}

  /* win line */
  .ls-winline{
    position:absolute;pointer-events:none;border-radius:10px;
    box-shadow:0 0 0 3px var(--win) inset,0 0 20px var(--win)
  }

  /* Modal */
  .ls-modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.5);z-index:999}
  .ls-modal.show{display:grid}
  .ls-card{background:#161a20;padding:20px;border-radius:14px;border:1px solid var(--line);width:500px;max-width:90%}
  .ls-row{display:flex;gap:10px;margin-bottom:10px}
  .ls-mini{font-size:11px;padding:7px 9px;border-radius:8px}
  .ls-danger{background:linear-gradient(90deg,#6b2a2a,#d85a5a);color:#fff}
  .ls-success{background:linear-gradient(90deg,#2b694a,#6dd5a1);color:#000}

</style>
</head>

<body>

<div class="ls-wrap" id="bingoApp">

  <h1 class="ls-logo">LOW SIGNAL</h1>
  <div class="ls-sub">single-click = edit • double-click = complete • 5×5 board • center is free</div>

  <div class="ls-controls" style="margin-top:12px;display:flex;gap:14px;flex-wrap:wrap;">
    <input class="ls-input" id="profileId" placeholder="profile id">
    <select class="ls-select" id="profilesList"></select>
    <button class="ls-btn" id="loadProfile">load</button>
    <button class="ls-btn" id="deleteProfile">delete</button>
    <button class="ls-btn save" id="saveProfile">save</button>
    <button class="ls-btn" id="resetBoard">reset</button>
  </div>

  <div class="ls-legend">Add a thread link + optional image per square. Win lines will glow.</div>

  <div class="ls-grid" id="grid"></div>

</div>

<!-- Modal -->
<div class="ls-modal" id="modal">
  <div class="ls-card">
    <h3>Edit Square</h3>
    <div class="ls-row"><input class="ls-input" id="promptInput" disabled></div>
    <div class="ls-row"><input class="ls-input" id="urlThread" placeholder="thread link"></div>
    <div class="ls-row">
      <input class="ls-input" id="urlImage" placeholder="image URL">
      <input type="file" class="ls-input" id="fileImage" accept="image/*">
    </div>

    <label><input type="checkbox" id="doneChk"> complete</label>

    <div class="ls-row" style="justify-content:flex-end;margin-top:14px;">
      <button class="ls-btn ls-mini ls-danger" id="clearImage">remove image</button>
      <button class="ls-btn ls-mini" id="closeModal">close</button>
      <button class="ls-btn ls-mini ls-success" id="saveSquare">save</button>
    </div>

  </div>
</div>

<script>
/* SAME JS as before,
   EXCEPT: banner removed, win squares get "win" class */

(function(){
  const THEMES={ /* your membergroups */ 
    'g-2':['#5078D2','#F58264','#FFD787'], 
    'g-4':['#8A5A16','#DFA546','#F8CC76'], 
    'g-6':['#A13D5B','#E8718A','#FFA0B2'], 
    'g-7':['#161B2E','#353E58','#616B89'], 
    'g-8':['#3D338D','#7362E8','#9D8CFF'], 
    'g-9':['#823424','#BF5C40','#E89A65'], 
    'g-10':['#00666D','#289DA5','#5AD2DC'], 
    'g-11':['#360000','#760A0A','#AA2727'], 
    'g-12':['#BEAF96','#E6DCC8','#FFFBEF'], 
    'g-13':['#856CB6','#C1AAE8','#DFD0FC'], 
    'g-14':['#78645A','#AA917D','#E1CDB9'], 
    'g-16':['#683616','#B55F2B','#E89952']
  };

  const qs=new URLSearchParams(location.search);
  let key=qs.get('theme');
  const bodyKey=[...document.body.classList].find(c=>THEMES[c]);
  if(!key||!THEMES[key]) key=bodyKey||'g-2';
  const [a,b,c]=THEMES[key];
  document.documentElement.style.setProperty('--accent1',a);
  document.documentElement.style.setProperty('--accent2',b);
  document.documentElement.style.setProperty('--accent3',c);

  const SIZE=5;
  const mid=12;
  const PREFIX='lowSignalBingo_v3_';

  const prompts=[
    "public argument","first kiss (or almost)","broken phone","rain confession",
    "caught lying","fake apology","late-night drive","crime of opportunity",
    "soft domestic","unexpected softness","wrong person saw","rivals to allies",
    "free space","stolen glance","self-sabotage","petty revenge",
    "drunk honesty","found footage","unreliable narration","secret exposed",
    "we shouldn’t be here","left on read","make a wish","meet messy","burn it down"
  ];

  const grid=document.getElementById('grid');
  const modal=document.getElementById('modal');
  const promptInput=document.getElementById('promptInput');
  const urlThread=document.getElementById('urlThread');
  const urlImage=document.getElementById('urlImage');
  const fileImage=document.getElementById('fileImage');
  const doneChk=document.getElementById('doneChk');
  const clearBtn=document.getElementById('clearImage');
  const closeBtn=document.getElementById('closeModal');
  const saveSquare=document.getElementById('saveSquare');

  const profileId=document.getElementById('profileId');
  const profilesList=document.getElementById('profilesList');
  const loadProfile=document.getElementById('loadProfile');
  const deleteProfile=document.getElementById('deleteProfile');
  const saveProfile=document.getElementById('saveProfile');
  const resetBoard=document.getElementById('resetBoard');

  function defaultBoard(){
    let list=[...prompts];
    let chosen=list.slice(0,SIZE*SIZE);
    chosen[mid]="free space";
    return chosen.map((t,i)=>({text:t,img:null,url:null,done:i===mid}));
  }

  function keyname(){return PREFIX+(profileId.value||"default")}
  function saveState(s){localStorage.setItem(keyname(),JSON.stringify(s))}
  function loadState(){try{return JSON.parse(localStorage.getItem(keyname()))}catch{return null}}

  let state=loadState()||defaultBoard();
  let selected=null;
  let winline=null;

  function listProfiles(){
    profilesList.innerHTML="";
    let keys=Object.keys(localStorage).filter(k=>k.startsWith(PREFIX));
    keys.forEach(k=>{
      let id=k.replace(PREFIX,"");
      let o=document.createElement('option');
      o.value=id;o.textContent=id;
      profilesList.append(o);
    });
  }

  function clearWin(){
    if(winline){winline.remove();winline=null}
    [...grid.children].forEach(c=>c.classList.remove('win'));
  }

  function drawWin(cells){
    clearWin();
    cells.forEach(i=>{
      const el=grid.children[i];
      if(el) el.classList.add('win');
    });
    const first=grid.children[cells[0]];
    const last=grid.children[cells[cells.length-1]];
    winline=document.createElement('div');
    winline.className='ls-winline';
    winline.style.left=(first.offsetLeft+6)+'px';
    winline.style.top=(first.offsetTop+6)+'px';
    winline.style.width=(last.offsetLeft-first.offsetLeft+last.offsetWidth-12)+'px';
    winline.style.height=(last.offsetTop-first.offsetTop+last.offsetHeight-12)+'px';
    grid.appendChild(winline);
  }

  function checkWin(){
    const lines=[];
    for(let r=0;r<5;r++) lines.push([r*5,r*5+1,r*5+2,r*5+3,r*5+4]);
    for(let c=0;c<5;c++) lines.push([c,c+5,c+10,c+15,c+20]);
    lines.push([0,6,12,18,24]);
    lines.push([4,8,12,16,20]);

    for(const line of lines){
      if(line.every(i=>state[i].done)){ drawWin(line); return; }
    }
    clearWin();
  }

  function render(){
    grid.innerHTML="";
    clearWin();

    state.forEach((cell,i)=>{
      const d=document.createElement('div');
      d.className="ls-cell"+(cell.done?" is-done":"");

      if(cell.img){
        const img=document.createElement('div');
        img.className="ls-img";
        img.style.backgroundImage=`url('${cell.img}')`;
        d.appendChild(img);
      }

      const shade=document.createElement('div'); shade.className='ls-shade';
      const text=document.createElement('div'); text.className='ls-text'; text.textContent=cell.text;
      const badge=document.createElement('div'); badge.className='ls-badge'; badge.textContent=(i===mid?"FREE":`#${i+1}`);

      if(cell.url){
        const link=document.createElement('a');
        link.className='ls-link'; link.href=cell.url; link.target="_blank";
        link.textContent=cell.url.replace(/^https?:\/\//,"").slice(0,30);
        d.appendChild(link);
      }

      const done=document.createElement('div'); done.className='ls-done';
      done.innerHTML="<div class='ls-check'>✔</div>";

      d.append(shade,badge,text,done);

      d.addEventListener('click',()=>openEditor(i));
      d.addEventListener('dblclick',(e)=>{e.preventDefault();toggle(i)});

      grid.appendChild(d);
    });

    checkWin();
  }

  function openEditor(i){
    selected=i;
    const cell=state[i];
    promptInput.value=cell.text;
    urlThread.value=cell.url||"";
    urlImage.value="";
    fileImage.value="";
    doneChk.checked=cell.done;
    modal.classList.add('show');
  }
  function closeEditor(){modal.classList.remove('show');selected=null}
  function toggle(i){
    state[i].done=!state[i].done;
    if(i===mid) state[i].done=true;
    saveState(state);render();
  }

  function fileToDataURL(file){
    return new Promise((res,rej)=>{
      const f=new FileReader();
      f.onload=()=>res(f.result);
      f.onerror=rej;
      f.readAsDataURL(file);
    });
  }

  saveSquare.addEventListener('click',async()=>{
    if(selected===null)return;
    const c=state[selected];
    c.url=urlThread.value.trim()||null;
    if(urlImage.value) c.img=urlImage.value.trim();
    if(fileImage.files[0]) c.img=await fileToDataURL(fileImage.files[0]);
    c.done=doneChk.checked||(selected===mid);
    saveState(state);render();closeEditor();
  });

  clearBtn.addEventListener('click',()=>{
    if(selected===null)return;
    state[selected].img=null; saveState(state);render();
  });

  closeBtn.addEventListener('click',closeEditor);

  saveProfile.addEventListener('click',()=>{
    saveState(state);listProfiles();
  });
  loadProfile.addEventListener('click',()=>{
    if(profilesList.value){profileId.value=profilesList.value;}
    state=loadState()||defaultBoard();
    saveState(state);render();
  });
  deleteProfile.addEventListener('click',()=>{
    if(!profilesList.value)return;
    localStorage.removeItem(PREFIX+profilesList.value);
    if(profileId.value===profilesList.value) profileId.value="";
    listProfiles();
  });
  resetBoard.addEventListener('click',()=>{
    if(!confirm("Reset board?"))return;
    state=defaultBoard(); saveState(state);render();
  });

  listProfiles();
  render();
})();
</script>

</body>
</html>
